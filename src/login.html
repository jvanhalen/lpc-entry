<!doctype html>
<html lang="en">
<head>
 <meta charset="utf-8" />
 <title>Galaxy All-Stars: Medieval Edition Login</title>
 <link rel="stylesheet" href="style-login.css" type="text/css" />

    <!-- Maple stuff -->
    <script type="text/javascript" src="./lib/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="./lib/jquery-validation-1.9.0/jquery.validate.min.js"></script>
    <script type="text/javascript" src="./lib/jquery.cookie.js"></script>
    <script type="text/javascript" charset="utf-8" src="../server/maple/lib/bison.js"></script>
    <script type="text/javascript" charset="utf-8" src="../server/maple/lib/Class.js"></script>
    <script type="text/javascript" charset="utf-8" src="../server/maple/lib/Twist.js"></script>
    <script type="text/javascript" charset="utf-8" src="../server/maple/Maple.js"></script>
    <script type="text/javascript" charset="utf-8" src="../server/maple/Client.js"></script> 
    <script type="text/javascript" charset="utf-8" src="./lib/sha-hash.js"></script>
    <script type="text/javascript" charset="utf-8" src="./lib/crafty.js"></script>
    <script type="text/javascript" charset="utf-8" src="ape-component.js"></script>
    <script type="text/javascript" charset="utf-8" src="gas-client.js"></script>
    <script type="text/javascript" charset="utf-8" src="./characters.js"></script>
    
    
    <script type="text/javascript">
    var type=10;
    function setType(value)
    {
	    type = value;
    }
    </script>
    
    <script type="text/javascript" charset="utf-8">
     // ****************************************
     // validator plugin settings: when submitted, 
     // we use GAS Maple server for authentication.
     // ****************************************
     $.validator.setDefaults({
	 submitHandler: function() { 
      var hashPass = Sha1.hash($('#password').val());
      var login = $('#username').val();
       gas.send(type, [ '{"username":"'+login+'"}' ]);
     }
     });
     // ****************************************
     // validator plugin rules for login form
     // ****************************************
      $().ready(function(){
        $('#loginform').validate({
         rules: {
         username:"required",
         password:"required"
         },
         messages: {
           username:"Please enter username or email",
           password:"Please enter password"
         }})
      });
    </script>

    <script type="text/javascript" charset="utf-8">
      var teams = ["Warriors of the Sun",
      "Shark Teeth",
      "Gray Wolves",
      "Chaos Power",
      "Bear Slayers",
      "Soldiers of the Moon",
      "Impatients",
      "Lords of Olor",
      "Lords of Darkness",
      "Ring Knights",
      "Grim Masters",
      "Dust Biters",
      "Guardians of Light",
      "Careless",
      "Bloodhounds"];

      function displayRanking()
      {
      $("#ranking").empty();
      $("#ranking").width(300);
      $("#ranking").append('<table>');
        for( t in teams)
        {
        $("#ranking").append('<tr><td>')
            .append(teams[t])
            .append('</td><td>')
            .append(0)
            .append('</td></tr>');
        }
        $("#ranking").append('</table>');
      // let's make Crafty aware of these changes.

      }

    </script>
</head>

<body>

  <div id="title">
    Galaxy All-Stars: Medieval Edition Login
  </div>
  <div id="login">
    <form method="post" id="loginform" action="">
      <fieldset>
	<div class="form-element">
          <label for="username">Username</label>
          <input type="text" name="username" id="username" class="required" />
        </div>
	<div class="form-element">
  	  <label for="password">Password</label>
	  <input name="password" type="password" id="password" class="required" />
	</div>
      </fieldset>
      <fieldset>
        <button type="submit" id="createbtn" title="Create new team" onclick="setType(2);"> >>&nbsp;&nbsp;Create</button>
        <button type="submit" id="loginbtn" title="Log in to an existing account" onclick="setType(10);"> >>&nbsp;&nbsp;Login</button>
      </fieldset>
    </form>
  </div>
  
  <a href="#" id="rank_link">Rankings</a><br/>
  <div id="ranking">
  </div>
  <script>
	Crafty.init(800, 800);
    Crafty.background('#4d5155');
    // Connect to GAS server
    var gas = new GAS();

    gas.connect('gassrv.dyndns.org', 8282);
    //gas.connect('localhost', 8282);
    Crafty.scene("managerView", showManagerView);
    Crafty.scene("gladiatorView", showGladiatorView);
    Crafty.scene("arenaView", showArenaView);


    var assetArray = [];
    GetLoadableAssetsFromTileMap( 'test.json',      assetArray);
    GetLoadableAssetsFromTileMap( 'inventory.json', assetArray);
    GetLoadableAssetsFromTileMap( 'arena.json', assetArray);
    Crafty.scene("loadingView", function(){
       console.log('Loading');
       for( var i=0;i< assetArray.length;i++)
       {
          console.log('About to load'+assetArray[i]);
       }
       Crafty.load(assetArray, function(e){ 
                       console.log('Done loading, starting manager!');
                       Crafty.scene("managerView"); });
    
       Crafty.e("2D, DOM, Text").attr({ w: 100, h: 20, x: 150, y: 120 })
      .text("Loading")
      .css({ "text-align": "center" });
    });
    
    if ( $.cookie("gas-login") ) {
          $('#login').fadeOut(500, function(){
             $('#login').empty();
             Crafty.scene("loadingView");
          });
    }
    // Ignore login for development..
    /*     $('#login').fadeOut(500, function(){
           $('#login').empty();
                       Crafty.scene("loadingView");
                       });*/
    // just a jQuery test for fading stuff in
    $("#rank_link").click(function(event){
    $("#ranking").fadeIn("slow");
    displayRanking();
    event.preventDefault();
    });

    
    

  </script>
  
   

</body>
</html>
